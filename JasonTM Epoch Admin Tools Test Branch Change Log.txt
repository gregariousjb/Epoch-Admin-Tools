Epoch Admin Tools Test Branch Change Log 1.0.6.1 - JasonTM

Quick summary of updates and changes (further explanation below)
* The Graphical Vehicle Menu has been upgraded and improved and replaces the old self action menu completely.
* Fixed base manager with new dialogs and PVDZ_Publish and PVDZ_obj_Destroy updates. Does not work with vectors.
* Updated the weather and dateset.
* Custom debug monitor integrated. Players can toggle it on and off with insert key.
* AI spawning moved server side with new features: choose hero/bandit ai, onMapSingleClick to choose location, and players are rewarded humanity gain/loss and bandit/human kills.
* Dynamic text notification option added to safezones.
* DayZ Epoch 1.0.6.2 Battleye configuration prevents crate spawning client side, so I moved it server side.
* Server side files and applicable client side files have been updated to use the new server_verifySender security function.
* Obsolete and redundant files and code have been removed after evaluation.
* setviewdistance menu added to player action Menu (1000-5000 meter adjustments).
* Admin Tools and Action Menu can now be activated with Hotkeys. F2 for admin menu and Tab for action menu.
* Toggle grass on/off added to player action menu.
* Reverted to the old keybinding system because keyboard.sqf is not necessary and adds unnecessary complication to the install. Keybindings updated.
* FunMenu and TransformAnimalMenu removed because the new version of Epoch prevents changing skins when gear is empty.
* FunMenu folder removed and movements.sqf moved to the actionMenu directory as a result of the change above.
* Updated anithack with eventhandler removal section. Not sure if it should be updated further.
* Updated deployBike.sqf and deployMozzie.sqf with fn_loopAction.
* Updated most of the files with the aesthetically pleasing dayzrollingmessages where applicable.
* Removed the helipad check in addvehicle.sqf because the new server-side antihack prevents spawning a vehicle more than 10 meters away.
* Removed the "if(_lockable > 1) then { //if item has code lock on it" section from adminBuild.sqf because it is not used. This file could be further simplified.
* Updated classnames in many files.
* Changed setdammage to setdamage in GodModeVehicle.sqf.
* Fixed handgun clearing in WeaponKits.sqf with a solution provided by Epoch Dev ebayShopper.
* There were two instances of EAT_RequireToolBoxMozzie in config.sqf, so I changed the appropriate one to EAT_RequirePartsMozzie and corrected file deployMozzie.sqf.
* Added crew count check and dayzrollingmessages notification to ejectPlayers.sqf.
* Updated flipVehicle.sqf with isnull check and vehicle display name in message.
* _EXECgenTools was not defined in contactAdminTickets.sqf and only used once, so I removed it and just entered the path for Teleport\returnPlayerTP.sqf.
* I commented out "Return Player to Last Pos" in AdminToolsMain due to it causing a security issue in the setpos.txt Battleye filter. Server owners can reenable it and set setPos.txt to log only.
* The above option might be OK because there is a setting in BEserver.cfg which prevents too many uses of setPos - MaxSetPosPerInterval 10 1.
* Since 1.0.6 the Epoch devs have added a mission file override prevention function. I have provided instructions to copy/paste this in server side file mission_check.sqf.
* GodModeVehicle.sqf changed variable setdammage to setdamage.
* Updated healp.sqf to PVDZ_Send
* Auto-detect The Overwatch mod and adjust crate spawning accordingly.
* BattlEye filters updated for 1.0.6.2.
* Install instructions updated.

Further Explanations

***Graphical Vehicle Menu***

I have added a new feature that allows server admins to choose between all vehicles and Epoch vehicles found in the traders. This makes it easier and faster to find player replacement vehicles.
This was accomplished by adding two new buttons to the top of the dialog box. In order to distinguish between moderators and admins, I added a new set of dialogs for mods called EAT_Veh_ModDialog that
do not load the new buttons. When a moderator logs on he will not see the new buttons and he will be limited to spawning Epoch trader vehicals only. The vehical lists are distinguished by toggling 
true/false to variable EAT_EpochOnlyVehicles. This variable is set to true by default for moderators. This makes the self action menu obsolete and it has been removed from AdminToolsMain.sqf along with
the associated files: malvehiclemenuneutral.sqf, malvehiclemenufriendly.sqf, malvehiclemenuhero.sqf, malvehiclemenubandit.sqf. This improves the organization and layout of the menu. I'm very happy with
the way this update turned out.

***Custom Debug Monitor***

This is the one from https://github.com/noxsicarius/Custom-Debug-Monitor It is enabled by default and can be toggled on and off with the insert key. It can be disabled by setting
variable EAT_DebugMonitor to false in config.sqf.

***AI Spawning***

In order to enable the extra features, I moved this file server side. This also prevents compromises in battleye filters. The selection process is accomplished client side in aiSpawn.sqf
and sent server side with EAT_PVEH_aiSpawn. I fixed the original sleep error associated with evanthandler "Killed" by switching to a scheduled environment with command spawn. At the top of
the file there are two variables which are configurable: The default settings are EAT_HumanityGainLoss = 25; and EAT_aiDeleteTimer = 600;. An additional menu has been added that lets the admin
choose between hero and bandit ai. I also added onMapSingleClick so that admins can choose any spot on the map to spawn the ai. The humanity gain/loss and bandit/human kills are dependent on
the AI type selected. Bandit and hero ai have a different skin selection.

***Safezones***
Server owners can choose among three different types of notification messages. I added dynamic text as an option. The options are set in config.sqf with the following line.
EAT_messageType = "DynamicText"; // Options: Hint, cutText, DynamicText - Do not use Hint if you have the debug monitor enabled.
I wrote call functions in safeZones.sqf that switches the message type based on the variable value.

	call {
	if (EAT_messageType == "DynamicText") exitWith {[format["<t size='0.70' color='#00cc00' align='center'>%1</t>",_enterMsg],0,-0.3,8,0.5] spawn BIS_fnc_dynamicText;};
	if (EAT_messageType == "cutText") exitWith {cutText[_enterMsg,"PLAIN DOWN"];};
	if (EAT_messageType == "Hint") exitWith {hint _enterMsg;};
	};
	
I also fixed a problem with players getting "Redirecting to your inventory..." messages when trying to access the gear on vehicles or pick things up in a safezone by adding isPlayer _ct to this check.

	if(!isNull (FindDisplay 106) && (!isNull _ct && !_friend && isPlayer _ct)) then {
	

***Server Side Crate Spawning and Temp Vehicle Spawning***

The DayZ Epoch devs have added additional security to BEserver.cfg, see below.

MaxAddBackpackCargoPerInterval 20 1
MaxAddMagazineCargoPerInterval 400 1
MaxAddWeaponCargoPerInterval 75 1
MaxCreateVehiclePerInterval 150 1
MaxDeleteVehiclePerInterval 100 1
MaxSetDamagePerInterval 3 1
MaxSetPosPerInterval 10 1

As you can see, Some of those settings prevent mass spawning by a client. This prevents admin crate spawning on the client side, so I moved it server side. I would rather do that then compromise security by 
disabling these settings. Moving crate spawning did have a downside as you cannot use createVehicleLocal to spawn a private crate. I don't think this is really an issue because admins can teleport to remote 
parts of the map to spawn crates out of the reach of players and delete them when they are done. As with my other server side files, I have added the security of the new server_verifySender function in 
1.0.6.2. The server sends the client an authentication key which must be submitted to the server when publishing buildables and vehicles, among other things. Any file which uses PVDZ_obj_Publish or PVDZ_obj_Destroy
has to submit the authentication key in variable form dayz_authKey along with submitting player. This is what the crate spawn code for this looks like: 

EAT_PVEH_crateSpawn = [_selectDelay,_crate,[_dir,_pos],_player,dayz_authKey];
	publicVariableServer "EAT_PVEH_crateSpawn";
	
The related server side code in file EAT_crateSpawn looks like this:

_exitReason = [_this,"EAT_crateSpawn",(_worldspace select 1),_clientKey,_playerUID,_activatingPlayer] call server_verifySender;
if (_exitReason != "") exitWith {diag_log _exitReason};

All three of my server side files have this. I also added the security of checking for admin status to the server side files with this:

if (!(_playerUID in EAT_adminList)) exitWith {diag_log format["Unauthorized player (%1 - %2) trying to spawn crates",_activatingPlayer,_playerUID];};

The vehicle spawning function uses EAT_adminModList so moderators can spawn temp vehicles. I tested this by disallowing moderators to spawn temp vehicles. I was not able spawn a temp vehicle logged on as moderator
and I got the expected diag_log message in the server rpt with my player name and playerUID.

***Mission Override Exploit***

There is a common public method of hijacking mission files with external code. The Epoch devs have implemented a mission file checking system where the client side mission file is compared to the server copy.
If they don't match, the server throws an unauthorized public variable at the client and it gets kicked by Battleye. In order for this to work, all of the files contained in the mission PBO must be listed
in server side file mission_check.sqf for comparison. I have provided the list of files in Epoch Admin Tools and provided instructions for copy/paste.

***Action Menu Updates***

Set View Distance has been added to the action menu. Players can choose from view distances ranging from 1000 meters to 5000 meters in 500 meter increments.
Toogle Grass On/Off has also been added as a toggle option. This is a pretty popular request.
Movement menu has been moved from the fun menu and moved to the main menu. The fun menu has been removed because after the removal of transform animal, there was only one entry left.


***Keybindings***

I reverted to the old system of keybinding because I found that it was not necessary to use keyboard.sqf. keyboard.sqf disables certain keystroke combinations to block in-game cheat activation.
This file was clumsy to implement and I found that it was not blocking any of the keys that I wanted to use, so I reverted to the old method. It makes the install easier and the admin tools more modular.
Since the 1.0.6 update, I and others have noticed that sometimes the admin menu and action menu will disappear and the only way to get them to reappear is to relog or get in and out of a vehicle so I have 
added the option to enable the admin menu and the action menu with keystrokes. The option can be turned on and off by variables EAT_AdminMenuHotkey and EAT_ActionMenuHotkey in config.sqf.
The are set to true by default because that feature is excellent. Setting then to false will revert to the self action menu loops. This is the list of all keybindings including the Epoch reserved keys:

F1  	- Toggle Earplugs
F2  	- Activate admin tools (if enabled by setting variable EAT_AdminMenuHotkey to true)
F3  	- Toggle UI status icons - new feature in DayZ Epoch 1.0.6.2.
F4  	- Admin mode/mod mode options - when toggled on
F5  	- Open group system - if enabled
F6  	- Cancel spectate
1  		- Switch to primary weapon
2   	- Switch to handgun
3   	- Switch to on back weapon
4  		- Admin teleport
5   	- Teleport player to admin
6   	- Teleport to player
7   	- Enhanced ESP options - when toggled on
U   	- Unlock vehicle/safe/lockbox/door
L   	- Lock vehicle/safe/lockbox/door
J   	- Display object information in systemchat
Del 	- Delete object
Ins 	- Toggle Debug
Tab 	- Activate action menu (if enabled by setting variable EAT_ActionMenuHotkey to true)
Shift+w - Fastwalk or vehicle boost - when enabled
q,w,a,s,d, and space bar are used if flying is toggled on

***dayzrollingmessages***

Most of the files have been updated where appropriate. For the most part, they are more aesthetically pleasing, but not always. In some cases they were not ideal because of set fade time and screen position.
Also, most of the garden variety public hacks use other messaging methods, so the Epoch devs added Battleye filters for them. Updating to dayzrollingmessages causes less headache with filter exceptions.

***Known Issues***

basemanager.sqf does not work with vectors. I tried to fix it, but it will take someone with better knowledge of the vector system to update it.

The GUI building system is still a bit wonky. If a building spawns too far away from the player, the building will get deleted because of the 20 meter movement limit. This system should probably have a separate build function.

That's it, two issues. Everything else is error free as far as I can tell.

***Removed Files***
As stated in the quick summary, changing into an animal is no longer possible due to the new gear check, so file morph.sqf as been removed along with the menu entries and associated with it.
teleportToLocation.sqf - this file was removed because it is redundant. An admin can teleport anywhere on the map with onMapSingleClick. It was disabled by default anyway.
PointToDelete.sqf - this file does the same thing as databaseremove.sqf. I have updated databaseremove.sqf to be faster with a yes/no menu instead of the countdown timer.
PointToRepair.sqf - this file is a temp version of PointToRepairPERM.sqf. I don't see a need for it.
PointToReviveVeh.sqf -  this file does not work very well and is not very useful.
PointToRefuel.sqf - Temp refuel. This file is not called anywhere and is not very useful because PointToRepairPERM.sqf already does that, but permanently.
As above malvehiclemenuneutral.sqf, malvehiclemenufriendly.sqf, malvehiclemenuhero.sqf, malvehiclemenubandit.sqf were removed because the graphical vehicle menu has been upgraded. All menus associated with
these three files have also been removed.


###End DayZ Epoch 1.0.6.2 Updates


JasonTM Epoch Admin Tools Test Branch Change Log 1.0.6.1

1. admintools\actionMenu\suicide.sqf - Update to work with updated player_death function
2. admintools\actionMenu\ActionsMenu.sqf - Corrected Variable name.
3. admintools\actionMenu\ActionsMenu.sqf - Corrected Variable name. Disabled TransformAnimalMenu due to gear check update in player_switchModel.sqf. With the 1.0.6+ update, it is no longer possible to change into animal skins due to an update to the gear check in player_switchModel.sqf. Changing into an aminal skin automatically deletes your gear and the update to player_switchModel.sqf prevents switching skins when inventory is empty.
4. admintools\crates\allweapons.sqf - changed the word "spawned" to "added" to avoid Battleye kick in publicvariableval.txt.
5. admintools\crates\backpack.sqf - updated classname TentStorageDomed2 to TentStorage (TentStorageDomed2 is no longer a valid classname in Epoch) and changed the word "spawned" to "added" to avoid Battleye kick in publicvariableval.txt.
6. admintools\crates\building.sqf - changed the word "spawned" to "added" to avoid Battleye kick in publicvariableval.txt. 
7. admintools\crates\items.sqf - changed the word "spawned" to "added" to avoid Battleye kick in publicvariableval.txt.
8. admintools\crates\weapons.sqf - changed the word "spawned" to "added" to avoid Battleye kick in publicvariableval.txt.
9. admintools\variables.sqf - added PVEH for server-side temp vehicle spawner.
10. admintools\variables.sqf - Lowered the total backpacks in EAT_backpackCrateContents array to 5 because the current tent selection in Epoch only hold 5 total.
11. admintools\variables.sqf - Updated classname FoodSteakCooked to FoodbeefCooked in array EAT_itemCrateMagazines.
12. admintools\tools\PointToLock.sqf - Updated to work with PVDZE_handleSafeGear (Safes and Lockboxes).
13. admintools\tools\PointToUnlock.sqf - Updated to work with PVDZE_handleSafeGear (Safes and Lockboxes).
14. admintools\tools\PointToRepairPERM.sqf - Updated to work with PVDZ_veh_Save.
15. admintools\tools\addtempvehicle.sqf - Updated with publicVariableServer to send vehicle parameters to server side spawning function.
16. admintools\tools\AdminMode\ESPenhanced.sqf - The solution for array buildableOjects looks like it should work but doesn't, so I changed it to a list of classnames.
17. admintools\tools\AdminMode\ESPenhanced.sqf - Changed Key 1 to Key 4 to access the menu because Key 1 is used for weapon switching in 1.0.6+
18. admintools\tools\AdminMode\ESPenhanced.sqf - Updated crashsite and supply drop classnames and added a correction for the heli crashsite display name.
19. admintools\activate.sqf - commented out files FunctionKeys.sqf and NumberKeys.sqf because the 1.0.6 update uses keyboard.sqf to manage the keys.
20. Added the directories dayz_code and dayz_server which contain the files for keyboard.sqf and the server side temp vehicle spawner.
21. Updated Battleye filters to work with 1.0.6+ Epoch update.
22. Updated README.md with the updated install instructions.
23. Added my changelog.
24. Added file getObjectDetails.sqf to admintools\tools. This file is bound to key J and displays object name, charID, ObjectId.
25. admintools/tools/AdminMode\GodModePlayer.sqf - removed the word enabled used with EAT_PVEH_usageLogger to avoid Battleye kick in publicvariableval.txt.
26. admintools\tools\addvehicle.sqf - changed the word "spawned" to "added" to avoid Battleye kick in publicvariableval.txt.
27. admintools\tools\AdminMode\GodModeVehicle.sqf - removed the word enabled to avoid Battleye kick in publicvariableval.txt.
28. admintools\tools\AdminMode\ESPenhanced.sqf - removed the word "enabled" to avoid Battleye kick in publicvariableval.txt.
29. admintools\tools\AdminMode\ESPplayer.sqf - removed the word "enabled" to avoid Battleye kick in publicvariableval.txt.
30. admintools\tools\AdminMode\Flying.sqf - changed the word "enabled" to "added" to avoid Battleye kick in publicvariableval.txt.
30. admintools\tools\AdminMode\speedboost.sqf - changed the word "enabled" to "added" to avoid Battleye kick in publicvariableval.txt.
31. admintools\tools\zombieSpawn.sqf - changed the word "spawned" to "added" to avoid Battleye kick in publicvariableval.txt.
32. admintools\AdminToolsMain.sqf - disabled client side AI spawner becauses it compromises Battleye security. AI spawning function should be moved server side.
33. admintools\AdminToolsMain.sqf - disabled Base Manager Menu until it is updated for 1.0.6+, base_manager.sqf needs to have its functions updated to work with the new trader dialogs. It does not work correctly and posts errors to the client side rpt.
34. admintools\variables.sqf - updated classnames in EAT_weaponCrateWeapons, EAT_weaponCrateMagazines, and EAT_itemCrateMagazines.
35. Removed some redundancy in Battleye scripts.txt.
